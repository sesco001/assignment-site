<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Assignment Pro</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 font-sans">

<nav class="bg-blue-900 text-white p-4 flex justify-between">
  <h1 class="text-xl font-bold">ðŸ“˜ Assignment Pro - Admin</h1>
  <button id="logoutBtn" class="px-3 py-2 bg-red-500 font-semibold rounded-lg">Logout</button>
</nav>

<section class="max-w-6xl mx-auto py-10 px-4">

<h2 class="text-3xl font-bold mb-6">All Users</h2>
<table class="w-full text-left border-collapse mb-10">
  <thead>
    <tr>
      <th class="border p-2">ID</th>
      <th class="border p-2">Full Name</th>
      <th class="border p-2">Email</th>
      <th class="border p-2">Role</th>
    </tr>
  </thead>
  <tbody id="membersList"></tbody>
</table>

<h2 class="text-3xl font-bold mb-6">Assignments Management</h2>
<table class="w-full text-left border-collapse">
  <thead>
    <tr>
      <th class="border p-2">Title</th>
      <th class="border p-2">User Email</th>
      <th class="border p-2">Status</th>
      <th class="border p-2">Paid</th>
      <th class="border p-2">Solution</th>
      <th class="border p-2">Actions</th>
    </tr>
  </thead>
  <tbody id="adminAssignments"></tbody>
</table>

</section>

<script>
// Dummy users
let users = [
  { id: 1, full_name: "Admin User", email: "marcasmatheka@gmail.com", password: "12345678", role: "admin" },
  { id: 2, full_name: "John Doe", email: "johndoe@example.com", password: "12345678", role: "user" },
  { id: 3, full_name: "Admin Two", email: "admin2@example.com", password: "admin1234", role: "admin" }
];

// Dummy assignments
let assignments = [
  { id: 1, title: "Essay on Geography", email: "johndoe@example.com", status: "Pending", paid: false, solution: null },
  { id: 2, title: "Math Assignment", email: "johndoe@example.com", status: "Pending", paid: false, solution: null }
];

const admin = JSON.parse(localStorage.getItem("user"));
if(!admin || admin.role !== "admin") window.location.href = "login.html";

document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("user");
  window.location.href = "login.html";
});

function loadMembers(){
  const tbody = document.getElementById("membersList");
  tbody.innerHTML = "";
  users.forEach(u => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${u.id}</td>
        <td class="border p-2">${u.full_name}</td>
        <td class="border p-2">${u.email}</td>
        <td class="border p-2">${u.role}</td>
      </tr>`;
  });
}

function loadAssignments(){
  const tbody = document.getElementById("adminAssignments");
  tbody.innerHTML = "";
  assignments.forEach(a => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${a.title}</td>
        <td class="border p-2">${a.email}</td>
        <td class="border p-2">
          <select id="status-${a.id}" onchange="updateStatus(${a.id})" class="border px-1 py-0.5 rounded">
            <option value="Pending" ${a.status==="Pending"?"selected":""}>Pending</option>
            <option value="Processing" ${a.status==="Processing"?"selected":""}>Processing</option>
            <option value="Success" ${a.status==="Success"?"selected":""}>Success</option>
          </select>
        </td>
        <td class="border p-2">${a.paid ? "Yes" : `<button onclick="markPaid(${a.id})" class="bg-green-500 text-white px-2 py-1 rounded">Mark Paid</button>`}</td>
        <td class="border p-2">
          <input type="text" id="solution-${a.id}" placeholder="Solution link" value="${a.solution||''}" class="border px-1 py-0.5 rounded"/>
          <button onclick="uploadSolution(${a.id})" class="bg-blue-500 text-white px-2 py-1 rounded ml-1">Update</button>
        </td>
      </tr>`;
  });
}

function markPaid(id){
  const a = assignments.find(a => a.id === id);
  if(a){
    a.paid = true;
    a.status = "Processing"; // automatic status change
    alert("Marked as paid and status set to Processing!");
    loadAssignments();
  }
}

function uploadSolution(id){
  const input = document.getElementById(`solution-${id}`);
  const val = input.value.trim();
  const a = assignments.find(a => a.id === id);
  if(a){
    a.solution = val;
    if(a.status==="Processing") a.status="Success"; // automatic success if solution added
    alert("Solution updated!");
    loadAssignments();
  }
}

function updateStatus(id){
  const select = document.getElementById(`status-${id}`);
  const a = assignments.find(a => a.id === id);
  if(a) a.status = select.value;
}

loadMembers();
loadAssignments();
</script>

</body>
</html>
